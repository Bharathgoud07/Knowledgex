{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  .profile-wrapper {
      max-width: 1100px;
      margin: 24px auto;
  }
  .profile-card-main {
      border-radius: 18px;
      overflow: hidden;
      border: none;
      box-shadow: 0 15px 35px rgba(0,0,0,0.10);
  }
  .profile-hero {
      background: radial-gradient(circle at top left, #2563eb, #1d4ed8, #0f172a);
      color: #fff;
      padding: 26px 28px;
      display: flex;
      align-items: center;
      gap: 18px;
  }
  .profile-avatar-lg {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.9);
      object-fit: cover;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }
  .profile-hero-username {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.02em;
  }
  .profile-hero-sub {
      font-size: .9rem;
      opacity: .9;
  }
  .profile-pill {
      border-radius: 999px;
      padding: 4px 10px;
      background: rgba(15,23,42,0.4);
      font-size: .8rem;
  }
  .profile-body {
      padding: 20px 24px 24px;
      background: #f8fafc;
  }
  .profile-section-card {
      border-radius: 14px;
      border: none;
      box-shadow: 0 10px 22px rgba(15,23,42,0.08);
  }
  .profile-section-card .card-header {
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
  }
  .profile-label {
      font-size: .8rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: #9ca3af;
  }
  .profile-value {
      font-size: .95rem;
      color: #111827;
  }
  .profile-stat-badge {
      background: #f3f4ff;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: .8rem;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 4px;
  }
</style>

<div class="profile-wrapper">
  <div class="card profile-card-main">
    <!-- HERO -->
    <div class="profile-hero">
      <img
        src="{% if profile.picture %}{{ profile.picture.url }}{% else %}{% static 'default.png' %}{% endif %}"
        alt="Avatar"
        class="profile-avatar-lg"
      />
      <div class="flex-grow-1">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
          <div>
            <div class="profile-hero-username">
              {{ request.user.username }}
            </div>
            <div class="profile-hero-sub">
              {{ request.user.email|default:"No email added" }}
            </div>

            <!-- Email verification + streaks -->
            <div class="mt-1 small">
              {% if profile.email_verified %}
                <span class="badge bg-success">Email verified</span>
              {% else %}
                <span class="badge bg-warning text-dark">Email not verified</span>
                <a href="{% url 'resend_verification' %}" class="badge bg-light text-dark ms-2">
                  Resend link
                </a>
              {% endif %}
            </div>

            <div class="mt-2 small text-light">
              üî• Streak: {{ profile.login_streak }} day(s)
              ‚Ä¢ Longest: {{ profile.longest_streak }} day(s)
            </div>

            {% if profile.college or profile.branch %}
              <div class="mt-2 small">
                <span class="profile-pill">
                  {% if profile.college %}{{ profile.college }}{% else %}College not set{% endif %}
                  {% if profile.branch %} ‚Ä¢ {{ profile.branch }}{% endif %}
                </span>
              </div>
            {% endif %}
          </div>

          <div class="mt-3 mt-lg-0 d-flex flex-column align-items-end gap-2">
            {% if profile_completion %}
              <div class="text-end">
                <span class="small d-block mb-1">Profile completion</span>
                <div class="progress" style="width: 170px; height: 7px;">
                  <div
                    class="progress-bar
                      {% if profile_completion < 50 %}bg-danger
                      {% elif profile_completion < 80 %}bg-warning
                      {% else %}bg-success{% endif %}"
                    role="progressbar"
                    style="width: {{ profile_completion }}%;"
                  ></div>
                </div>
                <span class="small">{{ profile_completion }}%</span>
              </div>
            {% endif %}

            <div class="d-flex gap-2">
              <a href="{% url 'edit_profile' %}" class="btn btn-light btn-sm">
                Edit profile
              </a>
              <a href="{% url 'change_password' %}" class="btn btn-outline-light btn-sm">
                Password
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BODY -->
    <div class="profile-body">
      <div class="row g-3">
        <!-- About -->
        <div class="col-lg-8">
          <div class="card profile-section-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">About</h6>
              {% if profile.bio %}
                <span class="badge bg-light text-muted">Bio added</span>
              {% endif %}
            </div>
            <div class="card-body">
              {% if profile.bio %}
                <p class="mb-3 small text-muted">{{ profile.bio }}</p>
              {% endif %}

              <div class="row gy-2">
                <div class="col-md-6">
                  <div class="profile-label">Full name</div>
                  <div class="profile-value">{{ profile.full_name|default:"‚Äî" }}</div>
                </div>

                <div class="col-md-6">
                  <div class="profile-label">College</div>
                  <div class="profile-value">{{ profile.college|default:"‚Äî" }}</div>
                </div>

                <div class="col-md-6">
                  <div class="profile-label">Branch</div>
                  <div class="profile-value">{{ profile.branch|default:"‚Äî" }}</div>
                </div>

                <div class="col-md-6">
                  <div class="profile-label">Location</div>
                  <div class="profile-value">{{ profile.location|default:"‚Äî" }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right column -->
        <div class="col-lg-4 d-flex flex-column gap-3">
          {% if profile_completion and missing_fields %}
          <div class="card profile-section-card">
            <div class="card-body p-3">
              <div class="profile-label mb-1">Missing fields</div>
              <ul class="small text-muted mb-2">
                {% for field in missing_fields %}
                  <li>{{ field }}</li>
                {% endfor %}
              </ul>
              <a href="{% url 'edit_profile' %}" class="btn btn-sm btn-outline-primary w-100">
                Complete profile
              </a>
            </div>
          </div>

          <div class="card profile-section-card">
            <div class="card-body p-3">
              <div class="profile-label mb-1">Achievements</div>
              <ul class="small mb-0">
                <li>üî• Login streak: {{ profile.login_streak }} day(s)</li>
                <li>üèÖ Longest streak: {{ profile.longest_streak }} day(s)</li>
                {% if request.user.resources.count >= 10 %}
                  <li>üìö Active uploader (10+ uploads)</li>
                {% endif %}
                {% if request.user.resources.count >= 30 %}
                  <li>üèÜ Super contributor (30+ uploads)</li>
                {% endif %}
              </ul>
            </div>
          </div>
          {% endif %}

          <!-- Links -->
          <div class="card profile-section-card">
            <div class="card-body p-3">
              <div class="profile-label mb-2">Links</div>
              <ul class="list-unstyled small mb-0">
                <li class="mb-1">
                  <span class="text-muted">GitHub:</span>
                  {% if profile.github %}
                    <a href="{{ profile.github }}" target="_blank">Open</a>
                  {% else %}<span>‚Äî</span>{% endif %}
                </li>
                <li class="mb-1">
                  <span class="text-muted">LinkedIn:</span>
                  {% if profile.linkedin %}
                    <a href="{{ profile.linkedin }}" target="_blank">Open</a>
                  {% else %}<span>‚Äî</span>{% endif %}
                </li>
                <li class="mb-1">
                  <span class="text-muted">Website:</span>
                  {% if profile.website_url %}
                    <a href="{{ profile.website_url }}" target="_blank">Open</a>
                  {% else %}<span>‚Äî</span>{% endif %}
                </li>
              </ul>
            </div>
          </div>

          <!-- Activity -->
          <div class="card profile-section-card">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="profile-label mb-0">Your activity</div>
                <!-- Make sure you have a URL named 'dashboard' or change this to 'my_activity' -->
                <a href="{% url 'dashboard' %}" class="small text-decoration-none">
                  Dashboard ‚Üí
                </a>
              </div>
              <div class="d-flex flex-wrap gap-2">
                <span class="profile-stat-badge">
                  Uploads: {{ request.user.resources.count }}
                </span>
                <span class="profile-stat-badge">
                  Favorites: {{ request.user.favorites.count }}
                </span>
                <span class="profile-stat-badge">
                  Comments: {{ request.user.comments.count }}
                </span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
